# ğŸ“ Arquitetura do Sistema LibShow

## VisÃ£o Geral da Arquitetura

O LibShow utiliza uma **arquitetura em 3 camadas** (Three-Tier Architecture) com clara separaÃ§Ã£o entre apresentaÃ§Ã£o, lÃ³gica de negÃ³cio e dados.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TIER 1: PRESENTATION                     â”‚
â”‚                    Frontend (React + Vite)                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              User Interface Components                â”‚   â”‚
â”‚  â”‚  â€¢ Login Page           â€¢ Livros Table               â”‚   â”‚
â”‚  â”‚  â€¢ Dashboard            â€¢ EmprÃ©stimos Form           â”‚   â”‚
â”‚  â”‚  â€¢ Admin Panel          â€¢ Reservas List              â”‚   â”‚
â”‚  â”‚  â€¢ RelatÃ³rios Charts    â€¢ Usuario Management         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  State Management                     â”‚   â”‚
â”‚  â”‚  â€¢ React Hooks (useState, useEffect)                 â”‚   â”‚
â”‚  â”‚  â€¢ Local State per Component                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  API Client Services                  â”‚   â”‚
â”‚  â”‚  â€¢ livroService.js      â€¢ emprestimoService.js       â”‚   â”‚
â”‚  â”‚  â€¢ usuarioService.js    â€¢ reservaService.js          â”‚   â”‚
â”‚  â”‚  â€¢ authService.js       â€¢ relatorioService.js        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    HTTP REST API (JSON)
                JWT Token Authentication
                   CORS Enabled
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TIER 2: BUSINESS LOGIC                     â”‚
â”‚                  Backend (Spring Boot 3.3.4)                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Security Layer (CROSS-CUTTING)         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  JwtRequestFilter                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Intercepta todas as requisiÃ§Ãµes             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Valida JWT Token                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Extrai usuÃ¡rio autenticado                  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  WebSecurityConfig                             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CORS Configuration                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Authentication Manager                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ BCrypt Password Encoder                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Controller Layer (REST API)             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ JwtAuthenticationController                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ POST /api/auth/login                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ POST /api/auth/register                     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ LivroController                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ GET    /api/livros                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ GET    /api/livros/{id}                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ POST   /api/livros                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ PUT    /api/livros/{id}                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ DELETE /api/livros/{id}                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ POST   /api/livros/{id}/decrease/{qty}      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ POST   /api/livros/{id}/increase/{qty}      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ UsuarioController                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ EmprestimoController                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ReservaController                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ RelatorioController                         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Service Layer                        â”‚   â”‚
â”‚  â”‚              (Business Logic & Validation)            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ LivroService                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ findAll()                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ findById(Long id)                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ save(Livro)                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ decreaseAvailableQuantity(Long, int)      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ increaseAvailableQuantity(Long, int)      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ EmprestimoService                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Valida disponibilidade                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Registra emprÃ©stimo                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Atualiza quantidade de livros             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Processa devoluÃ§Ã£o                        â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ReservaService                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ UsuarioService                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ RelatorioService                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ JwtUserDetailsService                       â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Repository Layer (Data Access)           â”‚   â”‚
â”‚  â”‚           (Spring Data JPA Repositories)              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ LivroRepository                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   extends JpaRepository<Livro, Long>        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ findAll()                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ findById()                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ save()                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ delete()                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Custom queries (se necessÃ¡rio)            â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ UsuarioRepository                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ EmprestimoRepository                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ReservaRepository                           â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Domain Layer (Model)                 â”‚   â”‚
â”‚  â”‚                   (JPA Entities)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ @Entity Livro                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Long id (PK)                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String titulo                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String autor                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String isbn                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ int anoPublicacao                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String editora                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ int quantidadeTotal                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ int quantidadeDisponivel                  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ @Entity Usuario                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Long id (PK)                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String nome                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String email                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String senha (BCrypt)                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String cpf                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String tipo (ALUNO/BIBLIOTECARIO/ADMIN)   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ @Entity Emprestimo                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Long id (PK)                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Usuario usuario (FK)                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Livro livro (FK)                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LocalDate dataEmprestimo                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LocalDate dataDevolucaoPrevista           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LocalDate dataDevolucaoReal               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Boolean devolvido                         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ @Entity Reserva                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Long id (PK)                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Usuario usuario (FK)                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Livro livro (FK)                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LocalDateTime dataReserva                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ String status (ATIVA/CANCELADA/ATENDIDA)  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                      JPA/Hibernate
                    SQL Queries (JDBC)
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TIER 3: DATA PERSISTENCE                   â”‚
â”‚                     Database (H2/PostgreSQL)                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Database Schema                      â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚   â”‚
â”‚  â”‚  â”‚   usuarios   â”‚                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                    â”‚   â”‚
â”‚  â”‚  â”‚ id (PK)      â”‚                                    â”‚   â”‚
â”‚  â”‚  â”‚ nome         â”‚                                    â”‚   â”‚
â”‚  â”‚  â”‚ email (UK)   â”‚                                    â”‚   â”‚
â”‚  â”‚  â”‚ senha        â”‚                                    â”‚   â”‚
â”‚  â”‚  â”‚ cpf (UK)     â”‚                                    â”‚   â”‚
â”‚  â”‚  â”‚ tipo         â”‚                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚   â”‚
â”‚  â”‚         â”‚                                            â”‚   â”‚
â”‚  â”‚         â”‚ 1                                          â”‚   â”‚
â”‚  â”‚         â”‚                                            â”‚   â”‚
â”‚  â”‚         â”‚ *                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚   emprestimos    â”‚    *    â”‚   livros    â”‚       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â—„â”€â”€â”€â”€â–º â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚   â”‚
â”‚  â”‚  â”‚ id (PK)          â”‚    1    â”‚ id (PK)     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ usuario_id (FK)  â”‚         â”‚ titulo      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ livro_id (FK)    â”‚         â”‚ autor       â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ data_emprestimo  â”‚         â”‚ isbn (UK)   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ data_dev_prev    â”‚         â”‚ ano_public. â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ data_dev_real    â”‚         â”‚ editora     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ devolvido        â”‚         â”‚ qtd_total   â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ qtd_disp.   â”‚       â”‚   â”‚
â”‚  â”‚         â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚         â”‚ 1                           â”‚              â”‚   â”‚
â”‚  â”‚         â”‚                             â”‚ 1            â”‚   â”‚
â”‚  â”‚         â”‚                             â”‚              â”‚   â”‚
â”‚  â”‚         â”‚ *                           â”‚ *            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚              â”‚   â”‚
â”‚  â”‚  â”‚     reservas     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚   â”‚
â”‚  â”‚  â”‚ id (PK)          â”‚                               â”‚   â”‚
â”‚  â”‚  â”‚ usuario_id (FK)  â”‚                               â”‚   â”‚
â”‚  â”‚  â”‚ livro_id (FK)    â”‚                               â”‚   â”‚
â”‚  â”‚  â”‚ data_reserva     â”‚                               â”‚   â”‚
â”‚  â”‚  â”‚ status           â”‚                               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Database Properties                   â”‚   â”‚
â”‚  â”‚  â€¢ Driver: H2 (embedded) / PostgreSQL                â”‚   â”‚
â”‚  â”‚  â€¢ URL: jdbc:h2:file:./data/db                       â”‚   â”‚
â”‚  â”‚  â€¢ JPA: Hibernate dialect                            â”‚   â”‚
â”‚  â”‚  â€¢ DDL: auto (update)                                â”‚   â”‚
â”‚  â”‚  â€¢ SQL logging: enabled                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Fluxo de Dados Detalhado

### Exemplo: Realizar EmprÃ©stimo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER ACTION                                              â”‚
â”‚    UsuÃ¡rio clica em "Emprestar Livro" no formulÃ¡rio        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. FRONTEND (React Component)                               â”‚
â”‚    const handleEmprestimo = async (data) => {               â”‚
â”‚      const response = await emprestimoService.create(data)  â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. API SERVICE (emprestimoService.js)                       â”‚
â”‚    create: (data) => {                                      â”‚
â”‚      return axios.post('/api/emprestimos', data, {          â”‚
â”‚        headers: { Authorization: `Bearer ${token}` }        â”‚
â”‚      })                                                      â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    HTTP POST Request
                 Content-Type: application/json
                Authorization: Bearer eyJhbGc...
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. BACKEND - Security Layer                                 â”‚
â”‚    JwtRequestFilter intercepta requisiÃ§Ã£o                   â”‚
â”‚    â€¢ Extrai token do header Authorization                   â”‚
â”‚    â€¢ Valida assinatura do JWT                               â”‚
â”‚    â€¢ Extrai claims (username, roles)                        â”‚
â”‚    â€¢ Define SecurityContext com Authentication              â”‚
â”‚    â€¢ Permite prosseguir se vÃ¡lido                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. BACKEND - Controller Layer                               â”‚
â”‚    @PostMapping("/api/emprestimos")                         â”‚
â”‚    public ResponseEntity<Emprestimo> createEmprestimo(      â”‚
â”‚        @RequestBody EmprestimoDTO dto) {                    â”‚
â”‚      Emprestimo emp = emprestimoService.realizarEmprestimo( â”‚
â”‚        dto.getUsuarioId(),                                  â”‚
â”‚        dto.getLivroId(),                                    â”‚
â”‚        dto.getDataDevolucao()                               â”‚
â”‚      );                                                      â”‚
â”‚      return ResponseEntity.ok(emp);                         â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. BACKEND - Service Layer (Business Logic)                 â”‚
â”‚    public Emprestimo realizarEmprestimo(                    â”‚
â”‚        Long usuarioId, Long livroId, LocalDate dataDev) {   â”‚
â”‚                                                              â”‚
â”‚      // 1. Buscar entidades                                 â”‚
â”‚      Usuario usuario = usuarioRepo.findById(usuarioId)      â”‚
â”‚        .orElseThrow(() -> new NotFoundException());         â”‚
â”‚                                                              â”‚
â”‚      Livro livro = livroRepo.findById(livroId)              â”‚
â”‚        .orElseThrow(() -> new NotFoundException());         â”‚
â”‚                                                              â”‚
â”‚      // 2. Validar disponibilidade                          â”‚
â”‚      if (livro.getQuantidadeDisponivel() <= 0) {            â”‚
â”‚        throw new BusinessException("Livro indisponÃ­vel");   â”‚
â”‚      }                                                       â”‚
â”‚                                                              â”‚
â”‚      // 3. Criar emprÃ©stimo                                 â”‚
â”‚      Emprestimo emprestimo = new Emprestimo();              â”‚
â”‚      emprestimo.setUsuario(usuario);                        â”‚
â”‚      emprestimo.setLivro(livro);                            â”‚
â”‚      emprestimo.setDataEmprestimo(LocalDate.now());         â”‚
â”‚      emprestimo.setDataDevolucaoPrevista(dataDev);          â”‚
â”‚      emprestimo.setDevolvido(false);                        â”‚
â”‚                                                              â”‚
â”‚      // 4. Atualizar quantidade do livro                    â”‚
â”‚      livroService.decreaseAvailableQuantity(livroId, 1);    â”‚
â”‚                                                              â”‚
â”‚      // 5. Salvar emprÃ©stimo                                â”‚
â”‚      return emprestimoRepo.save(emprestimo);                â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. BACKEND - Repository Layer                               â”‚
â”‚    emprestimoRepository.save(emprestimo)                    â”‚
â”‚    â€¢ Spring Data JPA traduz para SQL                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. DATABASE - SQL Execution                                 â”‚
â”‚    BEGIN TRANSACTION;                                       â”‚
â”‚                                                              â”‚
â”‚    INSERT INTO emprestimos (                                â”‚
â”‚      usuario_id, livro_id, data_emprestimo,                 â”‚
â”‚      data_devolucao_prevista, devolvido                     â”‚
â”‚    ) VALUES (?, ?, ?, ?, ?);                                â”‚
â”‚                                                              â”‚
â”‚    UPDATE livros                                            â”‚
â”‚    SET quantidade_disponivel = quantidade_disponivel - 1    â”‚
â”‚    WHERE id = ?;                                            â”‚
â”‚                                                              â”‚
â”‚    COMMIT;                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. RESPONSE FLOW (Volta pelo mesmo caminho)                 â”‚
â”‚    Database â†’ Repository â†’ Service â†’ Controller             â”‚
â”‚                                                              â”‚
â”‚    HTTP 200 OK                                              â”‚
â”‚    Content-Type: application/json                           â”‚
â”‚    {                                                         â”‚
â”‚      "id": 123,                                             â”‚
â”‚      "usuario": { ... },                                    â”‚
â”‚      "livro": { ... },                                      â”‚
â”‚      "dataEmprestimo": "2024-11-24",                        â”‚
â”‚      "dataDevolucaoPrevista": "2024-12-08",                 â”‚
â”‚      "devolvido": false                                     â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. FRONTEND - Update UI                                    â”‚
â”‚     â€¢ Exibe mensagem de sucesso                             â”‚
â”‚     â€¢ Atualiza lista de emprÃ©stimos                         â”‚
â”‚     â€¢ Atualiza quantidade disponÃ­vel do livro               â”‚
â”‚     â€¢ Limpa formulÃ¡rio                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## PadrÃµes Arquiteturais Aplicados

### 1. Layered Architecture (Arquitetura em Camadas)

**Objetivo:** Separar responsabilidades em camadas horizontais

```
Presentation â†’ Business Logic â†’ Data Access â†’ Database
```

**BenefÃ­cios:**

- âœ… SeparaÃ§Ã£o clara de responsabilidades
- âœ… Facilita manutenÃ§Ã£o
- âœ… Testabilidade (cada camada independente)
- âœ… ReutilizaÃ§Ã£o de cÃ³digo

### 2. MVC (Model-View-Controller)

**ImplementaÃ§Ã£o no LibShow:**

```
Model (Backend)
  â””â”€â–º Entities: Livro, Usuario, Emprestimo, Reserva

View (Frontend)
  â””â”€â–º React Components: Tables, Forms, Charts

Controller (Backend)
  â””â”€â–º REST Controllers: Endpoints HTTP
```

### 3. Repository Pattern

**ImplementaÃ§Ã£o:**

```java
public interface LivroRepository extends JpaRepository<Livro, Long> {
    // MÃ©todos CRUD automÃ¡ticos
    // Queries customizadas (se necessÃ¡rio)
}
```

**BenefÃ­cios:**

- âœ… AbstraÃ§Ã£o do acesso a dados
- âœ… Facilita troca de banco de dados
- âœ… Queries type-safe

### 4. Dependency Injection (DI)

**ImplementaÃ§Ã£o Spring:**

```java
@Service
public class LivroService {
    @Autowired  // InjeÃ§Ã£o automÃ¡tica
    private LivroRepository livroRepository;
}
```

**BenefÃ­cios:**

- âœ… Baixo acoplamento
- âœ… Facilita testes (mocks)
- âœ… ConfiguraÃ§Ã£o centralizada

### 5. RESTful API Design

**PrincÃ­pios aplicados:**

```
GET    /api/livros          â†’ Lista todos
GET    /api/livros/{id}     â†’ Busca por ID
POST   /api/livros          â†’ Cria novo
PUT    /api/livros/{id}     â†’ Atualiza
DELETE /api/livros/{id}     â†’ Remove

Stateless, JSON, HTTP Status Codes apropriados
```

## DecisÃµes Arquiteturais

### Por que 3 camadas?

**Alternativas consideradas:**

- âŒ MonolÃ­tico sem separaÃ§Ã£o â†’ DifÃ­cil manutenÃ§Ã£o
- âŒ Microservices â†’ Complexidade desnecessÃ¡ria para o escopo
- âœ… 3-tier â†’ Balance perfeito para o projeto

### Por que JWT?

**Alternativas consideradas:**

- âŒ Session-based â†’ NÃ£o escala horizontalmente
- âŒ OAuth2 â†’ Overhead desnecessÃ¡rio
- âœ… JWT â†’ Stateless, simples, padrÃ£o da indÃºstria

### Por que H2 em desenvolvimento?

**Alternativas consideradas:**

- âŒ PostgreSQL desde o inÃ­cio â†’ Setup complexo
- âœ… H2 (dev) + PostgreSQL (prod) â†’ Facilita desenvolvimento local

### Por que Spring Boot?

**Alternativas consideradas:**

- âŒ Node.js/Express â†’ Equipe com mais experiÃªncia em Java
- âŒ Django â†’ PreferÃªncia por Java no backend
- âœ… Spring Boot â†’ Ecossistema maduro, produtivo

## Tecnologias e VersÃµes

```yaml
Backend:
  Runtime: Java 21
  Framework: Spring Boot 3.3.4
  ORM: Hibernate (via Spring Data JPA)
  Security: Spring Security + JWT
  Build: Maven 3.x
  Database Dev: H2 (embedded)
  Database Prod: PostgreSQL (sugerido)

Frontend:
  Runtime: Node.js 18+ (LTS)
  Library: React 19
  Build Tool: Vite 5
  UI Components: shadcn/ui
  Styling: Tailwind CSS 4
  Icons: Lucide React
  HTTP Client: Axios / Fetch API

DevOps:
  Version Control: Git
  Repository: GitHub
  Testing: JUnit 5, Mockito
  IDE: IntelliJ IDEA / VS Code
```

## SeguranÃ§a

### AutenticaÃ§Ã£o JWT Flow

```
1. Login Request
   â””â”€â–º POST /api/auth/login { email, senha }

2. Backend valida credenciais
   â””â”€â–º Busca usuÃ¡rio no banco
   â””â”€â–º Compara senha (BCrypt)

3. Gera JWT Token
   â””â”€â–º Payload: { username, roles, exp }
   â””â”€â–º Assina com chave secreta

4. Retorna token
   â””â”€â–º { "token": "eyJhbGc..." }

5. Frontend armazena token
   â””â”€â–º localStorage ou sessionStorage

6. RequisiÃ§Ãµes subsequentes
   â””â”€â–º Header: Authorization: Bearer eyJhbGc...

7. Backend valida token
   â””â”€â–º JwtRequestFilter intercepta
   â””â”€â–º Verifica assinatura
   â””â”€â–º Extrai usuÃ¡rio
   â””â”€â–º Define SecurityContext
```

### ProteÃ§Ã£o de Endpoints

```java
@Configuration
public class WebSecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http
            .csrf().disable()  // API REST stateless
            .authorizeRequests()
                .antMatchers("/api/auth/**").permitAll()  // Login pÃºblico
                .antMatchers("/api/**").authenticated()    // Demais requer auth
            .and()
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS);

        return http.build();
    }
}
```

## Escalabilidade

### Pontos de Escalabilidade

1. **Horizontal Scaling**

   - Backend stateless (JWT) â†’ MÃºltiplas instÃ¢ncias
   - Frontend estÃ¡tico â†’ CDN

2. **Caching** (futuro)

   - Redis para sessÃµes
   - Cache de queries frequentes

3. **Database** (futuro)

   - Read replicas
   - Connection pooling

4. **Load Balancing** (futuro)
   - Nginx / AWS ELB
   - MÃºltiplas instÃ¢ncias Spring Boot

---

## Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LIBSHOW SYSTEM                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend Module    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Backend Module     â”‚  â”‚
â”‚  â”‚                     â”‚  HTTP   â”‚                     â”‚  â”‚
â”‚  â”‚  - React App        â”‚  REST   â”‚  - Spring Boot App  â”‚  â”‚
â”‚  â”‚  - UI Components    â”‚  JSON   â”‚  - REST API         â”‚  â”‚
â”‚  â”‚  - State Mgmt       â”‚  JWT    â”‚  - Business Logic   â”‚  â”‚
â”‚  â”‚  - API Clients      â”‚         â”‚  - Security         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚ JPA         â”‚
â”‚                                              â–¼             â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                   â”‚  Database Module    â”‚  â”‚
â”‚                                   â”‚                     â”‚  â”‚
â”‚                                   â”‚  - H2/PostgreSQL    â”‚  â”‚
â”‚                                   â”‚  - Tables/Schema    â”‚  â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Documento criado para:** LibShow - Sistema de Gerenciamento de Biblioteca  
**Data:** Novembro 2024  
**Disciplina:** Engenharia de Software 2 - PUC Minas
